checkout:
  pre:
  post:
dependencies:
  pre:
    - sudo update-alternatives --set java /usr/lib/jvm/jdk1.8.0/bin/java
    - sudo update-alternatives --set javac /usr/lib/jvm/java-8-openjdk-amd64/bin/javac
    - echo 'export JAVA_HOME=/usr/lib/jvm/java-8-openjdk-amd64' >> ~/.circlerc
  override:
    - mvn dependency:resolve
    - mvn dependency:resolve-plugins
    - mvn dependency:go-offline
    - mvn dependency:tree
  post:
test:
  pre:
  override:
    - mvn -B -Dorg.slf4j.simpleLogger.log.org.apache.maven.cli.transfer.Slf4jMavenTransferListener=warn verify
    - if [[ -z $CI_PULL_REQUEST ]] ; then mvn -B -Dorg.slf4j.simpleLogger.log.org.apache.maven.cli.transfer.Slf4jMavenTransferListener=warn -Drepotoken=$repotoken jacoco:report coveralls:report ; fi
  post:
    - mkdir -p $CIRCLE_TEST_REPORTS/junit/
    - find . -type f -regex ".*/target/surefire-reports/.*xml" -exec cp {} $CIRCLE_TEST_REPORTS/junit/ \;
deployment:
  production:
    branch: release
    commands:
      - mvn deploy
